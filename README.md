# Integration Tests for ServeRest

This project contains integration tests for the [ServeRest](https://serverest.dev/) API, developed using TypeScript, Jest, and Supertest. The tests can be executed in different environments, either by using ServeRest hosted remotely, running it locally, or using a Docker container.

## Prerequisites

Ensure the following tools are installed in your development environment:

-   Node.js (version 18+ recommended)
-   Docker (if you plan to run ServeRest in a container)
-   TypeScript
-   ESLint

## Installation

Clone the repository and install the necessary dependencies:

```bash
git clone https://github.com/ihorkk/integration_tests.git
cd integration_tests
npm install

```

## Running the Tests

There are three ways you can run the tests, depending on your setup.

### 1. Using the Remote ServeRest API

To run these tests on the remotely hosted instance, simply uncomment the corresponding BASE_URL inside the .env file.
Then run the following command:

```bash
npm run test:integration
```

### 2. Running ServeRest Locally

To run these tests locally, simply uncomment the corresponding BASE_URL inside the .env file.
Then run the following commands:

```bash
npm run run:locally
npm run test:integration
```

### 3. Running ServeRest in Docker

By default, the tests are configured to execute against the ServeRest instance running inside Docker containers. The project uses docker-compose to manage the containers for both ServeRest and the test environment. The run-tests.sh script will build and run the Docker containers, execute the tests, and then clean up the environment.

First, ensure that Docker and Docker Compose are installed on your system. Then, to start the tests inside Docker, use the following command:

```bash
npm run test:docker
```

This will execute the following steps:

1. Build and run the Docker containers defined in the docker-compose.yml file.
2. Run the tests inside the Docker containers.
3. Automatically clean up the Docker containers after the tests are finished.

## Linting

To check code style and ensure the project meets the set linting rules, you can use the following command:

```bash
npm run lint
```

To automatically fix linting issues:

```bash
npm run lint:fix
```

## Test Reports

After running the tests, you can view the test report generated by jest-stare by opening the report in a browser:

```bash
npm run open:report
```

The report is located at ./results/jest-stare/index.html.

## Available Scripts

Here is a summary of the main scripts available:

-   build: Type-check the code using TypeScript.
-   test: Run a filtered test suite by passing a filter string.
-   test:integration: Run the full integration test suite.
-   test:integration:silent: Run the full test suite in silent mode.
-   run:locally: Start ServeRest on your local machine.
-   run:docker: Start ServeRest using Docker.
-   test:docker: Run the tests in a Docker container.
-   lint: Run ESLint to check for code issues.
-   lint:fix: Automatically fix linting issues.
-   open:report: Open the test report in the default browser.

## Test Structure

The project is organized as follows:

```
integration_tests
├─ .gitignore
├─ babel.config.json
├─ common.ts
├─ eslint.config.mjs
├─ package-lock.json
├─ package.json
├─ src
│  ├─ Data
│  │  └─ Bodies
│  ├─ Objects
│  ├─ Resources
│  │  └─ Requests
│  ├─ Tests
│  ├─ Utils
│  └─ Validators
└─ tsconfig.json

```

-   Data: This directory contains reusable payloads for making requests to the ServeRest API. Each entity (e.g., Users, Products) has its own subdirectory with relevant request bodies.
-   Objects: Contains TypeScript definitions of request and response objects used in tests.
-   Resources: Handles HTTP requests to the ServeRest API using Supertest.
-   Tests: Contains the integration tests, organized by feature (e.g., Login, Users, Products).
-   Validators: Validates the responses returned from the API to ensure they meet expected conditions.

## Dependencies

-   TypeScript: Type safety for the test code.
-   Jest: Testing framework.
-   Supertest: HTTP assertions for integration testing.
-   ESLint: Linting and style guide enforcement.
-   Faker JS: Randomize test data
-   Jest-Stare: HTML reports for test results.
-   Docker: For containerized testing (optional).
